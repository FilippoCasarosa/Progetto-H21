{"ast":null,"code":"import { timer } from 'rxjs';\nimport { DialogComponent } from '../shared/dialog/dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../shared/services/component-type.service\";\nimport * as i2 from \"../shared/services/list.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/material/dialog\";\nimport * as i5 from \"@angular/material/snack-bar\";\nimport * as i6 from \"../auth/auth.service\";\n\nconst _c0 = function (a1) {\n  return [\"components-by-type\", a1];\n};\n\nfunction ListComponent_ng_container_3_button_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 12);\n    i0.ɵɵtext(1, \"Aggiungi \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const componentType_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(1, _c0, componentType_r6.id));\n  }\n}\n\nfunction ListComponent_ng_container_3_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 13);\n    i0.ɵɵlistener(\"click\", function ListComponent_ng_container_3_button_5_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext(2);\n      return ctx_r10.completeConfiguration();\n    });\n    i0.ɵɵtext(1, \"Finisci per me \");\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r8 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r8.isFirst === true);\n  }\n}\n\nfunction ListComponent_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h3\", 9)(2, \"b\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(4, ListComponent_ng_container_3_button_4_Template, 2, 3, \"button\", 10);\n    i0.ɵɵtemplate(5, ListComponent_ng_container_3_button_5_Template, 2, 1, \"button\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const componentType_r6 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(componentType_r6.name);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", componentType_r6.active);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", componentType_r6.active);\n  }\n}\n\nfunction ListComponent_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"tr\")(2, \"td\")(3, \"h2\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(5, \"td\")(6, \"h2\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"td\")(9, \"h2\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const pcComponent_r12 = ctx.$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(pcComponent_r12.componentFamily.type.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(pcComponent_r12.name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", pcComponent_r12.price, \" $\");\n  }\n}\n\nfunction ListComponent_button_24_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"button\", 14);\n    i0.ɵɵlistener(\"click\", function ListComponent_button_24_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return ctx_r13.confirmConfig();\n    });\n    i0.ɵɵtext(1, \"Conferma Configurazione \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListComponent_button_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 15);\n    i0.ɵɵtext(1, \"Salva \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListComponent_p_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction ListComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 16)(1, \"h1\");\n    i0.ɵɵtext(2, \"An Error Occured\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function ListComponent_div_27_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return ctx_r15.onHandleError();\n    });\n    i0.ɵɵtext(6, \"Okay\");\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r5.error);\n  }\n}\n/**\r\n * @author Filippo Casarosa\r\n */\n\n\nexport let ListComponent = /*#__PURE__*/(() => {\n  class ListComponent {\n    constructor(componentTypeService, listService, router, dialog, _snackBar, authService) {\n      this.componentTypeService = componentTypeService;\n      this.listService = listService;\n      this.router = router;\n      this.dialog = dialog;\n      this._snackBar = _snackBar;\n      this.authService = authService;\n      this.error = null;\n      this.horizontalPosition = 'center';\n      this.verticalPosition = 'top';\n      this.loadedComponentTypes = [];\n      this.pcComponents = [];\n      this.isFetching = false;\n      this.totalPrice = 0;\n      this.totalPower = 0;\n      this.powerSupplied = 0;\n      this.enableCompleteButton = false;\n      this.isAuthenticated = false;\n      this.isFirst = false;\n    }\n\n    ngOnInit() {\n      this.adminSub = this.authService.admin.subscribe(admin => {\n        this.isAuthenticated = !!admin;\n      });\n      this.fetchComponentType();\n\n      if (this.listService.getList().length >= 1) {\n        this.isFirst = false;\n        this.fetchConfiguration();\n      } else {\n        this.isFirst = true;\n      }\n    }\n    /**\r\n     * Chiude l'observable che ha la funzione di mostrare l'errore\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    ngOnDestroy() {\n      this.errorSub.unsubscribe;\n      this.adminSub.unsubscribe;\n    }\n    /**\r\n     * Resetta l'errore a null\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    onHandleError() {\n      this.error = null;\n    }\n    /**\r\n     * Recupera tutti i ComponentType\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    fetchComponentType() {\n      this.errorSub = this.componentTypeService.error.subscribe(errorMessage => {\n        this.error = errorMessage;\n      });\n      this.isFetching = true;\n      this.componentTypeService.getComponentType().subscribe(componentType => {\n        this.isFetching = false;\n        this.loadedComponentTypes = componentType.map((current, index) => {\n          return Object.assign(Object.assign({}, current), {\n            active: index === this.listService.getCurrent()\n          });\n        });\n        console.log('Component Types');\n        console.log(this.loadedComponentTypes);\n\n        if (this.pcComponents.length === this.loadedComponentTypes.length) {\n          this.enableCompleteButton = true;\n        } else {\n          this.enableCompleteButton = false;\n        }\n      }, error => {\n        this.isFetching = false;\n        this.error = error.message;\n      });\n    }\n    /**\r\n     * Recupera la configurazione\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    fetchConfiguration() {\n      this.pcComponents = this.listService.getList();\n      console.log('pcComponents');\n      console.log(this.pcComponents);\n      this.totalPrice = this.listService.getTotalPrice();\n      console.log('Get total price');\n      console.log(this.totalPrice);\n      this.totalPower = this.listService.getTotalPower();\n      console.log('TotalPower');\n      console.log(this.totalPower);\n      this.powerSupplied = this.listService.getPowerSupplied();\n      console.log('Power Supplied');\n      console.log(this.powerSupplied);\n    }\n    /**\r\n     * conferma Configurazione\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    confirmConfig() {\n      if (this.listService.checkPowerSupplied()) {\n        this.openSnackBar();\n        this.listService.deleteLastComponent();\n        this.fetchComponentType();\n      } else {\n        const dialogRef = this.dialog.open(DialogComponent, {\n          width: '330px'\n        });\n        dialogRef.afterClosed().subscribe(result => {\n          console.log('The dialog was closed');\n        });\n      }\n    }\n\n    completeConfiguration() {\n      this.listService.autoConfig(this.pcComponents[this.pcComponents.length - 1].componentFamily.type.id);\n      let time = timer(200, 200);\n      time.subscribe(() => {\n        this.fetchComponentType();\n        this.totalPrice = this.listService.getTotalPrice();\n        this.totalPower = this.listService.getTotalPower();\n        this.powerSupplied = this.listService.getPowerSupplied();\n      }); // this.router.navigate(['/prebuilts']);\n      // this.router.navigate(['/list']);\n    }\n    /**\r\n     * apre SnackBar per errore potenza\r\n     * @author Filippo Casarosa\r\n     */\n\n\n    openSnackBar() {\n      this._snackBar.open('Potenza erogata non sufficiente', 'ok', {\n        horizontalPosition: this.horizontalPosition,\n        verticalPosition: this.verticalPosition\n      });\n    }\n\n  }\n\n  ListComponent.ɵfac = function ListComponent_Factory(t) {\n    return new (t || ListComponent)(i0.ɵɵdirectiveInject(i1.ComponentTypeService), i0.ɵɵdirectiveInject(i2.ListService), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.MatDialog), i0.ɵɵdirectiveInject(i5.MatSnackBar), i0.ɵɵdirectiveInject(i6.AuthService));\n  };\n\n  ListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ListComponent,\n    selectors: [[\"app-list\"]],\n    decls: 28,\n    vars: 12,\n    consts: [[\"mode\", \"side\", \"fixedInViewport\", \"false\", 1, \"sidenav\", 3, \"opened\"], [4, \"ngFor\", \"ngForOf\"], [1, \"content\"], [2, \"color\", \"brown\"], [\"role\", \"alert\", 1, \"alert\", \"alert-warning\", 2, \"width\", \"80vh\", \"margin\", \"15px\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", \"routerLink\", \"/add-prebuilt\", 4, \"ngIf\"], [4, \"ngIf\"], [\"class\", \"alert alert-danger\", 4, \"ngIf\"], [2, \"margin-left\", \"5px\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"routerLink\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"routerLink\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"disabled\", \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", \"routerLink\", \"/add-prebuilt\"], [1, \"alert\", \"alert-danger\"], [1, \"btn\", \"btn-danger\", 3, \"click\"]],\n    template: function ListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"mat-sidenav-container\")(1, \"mat-sidenav\", 0)(2, \"mat-nav-list\");\n        i0.ɵɵtemplate(3, ListComponent_ng_container_3_Template, 6, 3, \"ng-container\", 1);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(4, \"mat-sidenav-content\", 2)(5, \"h1\", 3);\n        i0.ɵɵtext(6, \"Componenti Selezionati:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 4)(8, \"h3\")(9, \"b\");\n        i0.ɵɵtext(10, \"Potenza della configurazione: \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtext(11);\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"table\");\n        i0.ɵɵtemplate(13, ListComponent_ng_container_13_Template, 11, 3, \"ng-container\", 1);\n        i0.ɵɵelementStart(14, \"tfoot\")(15, \"tr\")(16, \"td\")(17, \"h2\")(18, \"b\");\n        i0.ɵɵtext(19, \"Costo Totale\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(20, \"td\")(21, \"h2\");\n        i0.ɵɵtext(22);\n        i0.ɵɵpipe(23, \"number\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵtemplate(24, ListComponent_button_24_Template, 2, 0, \"button\", 5);\n        i0.ɵɵtemplate(25, ListComponent_button_25_Template, 2, 0, \"button\", 6);\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(26, ListComponent_p_26_Template, 2, 0, \"p\", 7);\n        i0.ɵɵtemplate(27, ListComponent_div_27_Template, 7, 1, \"div\", 8);\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"opened\", true);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.loadedComponentTypes);\n        i0.ɵɵadvance(8);\n        i0.ɵɵtextInterpolate(ctx.totalPower);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.pcComponents);\n        i0.ɵɵadvance(9);\n        i0.ɵɵtextInterpolate1(\"\", i0.ɵɵpipeBind2(23, 9, ctx.totalPrice, \"1.2-2\"), \" $\");\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.enableCompleteButton);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isAuthenticated && ctx.enableCompleteButton);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.isFetching && !ctx.error);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.error);\n      }\n    },\n    styles: [\"table[_ngcontent-%COMP%]{width:70vw}.sidenav[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]{height:88vh;width:auto;overflow:auto}button[_ngcontent-%COMP%]{margin:5px}\"]\n  });\n  return ListComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}